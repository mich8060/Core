(function ($) {
	$.fn.setProgress = function(percent) {
		$el = $('.progress');
		$el.css({
			'opacity':1,
			'width':percent+"%"
		});
	};
	
	$.fn.resetProgress = function() {
		$el = $('.progress');
		window.setTimeout(function(){
			$el.css({
				'opacity':'0',
			});
		},3000);
		window.setTimeout(function(){
			$el.css({
				'width':'0px',
			});
		},5400);
	};
	
	$.fn.bytesToSize = function(bytes) {
	    var sizes = ['Bytes', 'KB', 'MB'];
	    if (bytes == 0) return 'n/a';
	    var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
	    return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
	};
	
	$.fn.hover = function(fnOver,fnOut) {
		return this.mouseenter(fnOver).mouseleave(fnOut || fnOver);
	};
	
	$.fn.mediaQuery = function(callback) {
		window.onresize = callback;
	}
	
	$.fn.buildFeed = function(columns) {
		for(x = 0;x <= (columns - 1);x++){
			$('.feed').append('<div class="grid_'+columns+' flush"></div>');
		}
		
		$('.item').each(function(i){
			$('.feed').find('.grid_'+columns).eq(i % columns).append($(this).clone());
			$(this).remove();
		});
		$('.feed').append('<div class="clear"></div>');
	}
	
})(Zepto);

$(document).ready(function(){
	
	prettyPrint();
	
	var breakpoint = null; 
	var current = 0;
	
	$.fn.feedBreakpoints = function(){
		var w = window.innerWidth;
		if(w >= 1024){
			breakpoint = 4;
		}else if(w < 1024 && w > 900){
			breakpoint = 3;
		}else if(w < 899 && w > 761){
			breakpoint = 2;
		}
		if(current != breakpoint){
			current = breakpoint;
			$(this).buildFeed(breakpoint);
		}	
	}
	
	if($('.feed').length){
		$(this).feedBreakpoints();
		$(this).mediaQuery(function(){
			$(this).feedBreakpoints();
		});
	}
	
	if($('.article-img-full').length){
		$('.article-img-fill').before('</div>').after('<div>');
	}
	
});